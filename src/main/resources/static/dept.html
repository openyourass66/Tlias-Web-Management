<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>部门管理</title>
    <style>
        table{
            width: 1000px;
            margin: 20px auto;
            border-collapse:collapse;
        }
        caption{
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        td,th{
            text-align: center;
            border-bottom: 1px solid black;
            padding: 8px;
        }
        th{
            background-color: #ddd;
        }
        .operation{
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        button{
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .add-btn{
            background-color: #4CAF50;
            color: white;
        }
        .edit-btn{
            background-color: #2196F3;
            color: white;
        }
        .delete-btn{
            background-color: #f44336;
            color: white;
        }
    </style>
</head>
<body>
<div id="app">
    <table>
        <caption>
            部门管理
            <button class="add-btn" @click="add">添加</button>
        </caption>
        <thead>
        <tr>
            <th>部门编号</th>
            <th>部门名称</th>
            <th>创建时间</th>
            <th>更新时间</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <tr v-if="list.length === 0">
            <td colspan="5" style="color: #999;">暂无部门数据</td>
        </tr>
        <tr v-for="item in list" :key="item.id">
            <td>{{item.id}}</td>
            <td>{{item.name}}</td>
            <td>{{formatDate(item.createTime)}}</td>
            <td>{{formatDate(item.updateTime)}}</td>
            <td class="operation">
                <button class="edit-btn" @click="update(item.id)">修改</button>
                <button class="delete-btn" @click="del(item.id)">删除</button>
            </td>
        </tr>
        </tbody>
    </table>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
    const app = new Vue({
        el: '#app',
        data: {
            list: []
        },
        created() {
            this.getList()
        },
        methods: {
            // 获取部门列表
            async getList() {
                try {
                    const res = await axios.get("http://localhost:8080/depts")
                    if (res.data.code === 1) {
                        this.list = res.data.data
                    }
                } catch (error) {
                    console.error("获取部门列表失败：", error)
                    alert("网络错误，获取部门列表失败")
                }
            },
            // 格式化日期显示
            formatDate(dateStr) {
                if (!dateStr) return '';
                return new Date(dateStr).toLocaleString('zh-CN');
            },
            // 添加部门
            async add() {
                const name = prompt("请输入部门名称：").trim()
                if (!name) return

                if (!confirm("确定要添加吗？")) return

                try {
                    const res = await axios.post("http://localhost:8080/depts", {
                        name,
                        createTime: new Date().toISOString(),
                        updateTime: new Date().toISOString()
                    })
                    if (res.data.code === 1) {
                        this.getList()
                        alert("添加成功")
                    } else {
                        alert("添加失败")
                    }
                } catch (error) {
                    console.error("添加失败：", error)
                    alert("网络错误，添加失败")
                }
            },
            // 根据id查询部门
            async getById(id) {
                try {
                    const res = await axios.get(`http://localhost:8080/depts/${id}`)
                    if (res.data.code === 1) {
                        return res.data.data
                    } else {
                        alert("查询失败")
                        return null
                    }
                } catch (error) {
                    console.error("查询失败：", error)
                    alert("网络错误，查询失败")
                    return null
                }
            },
            // 修改部门
            async update(id) {
                const dept = await this.getById(id)
                if (!dept) return

                const newName = prompt("请输入新部门名称：", dept.name).trim()
                if (!newName) return

                if (!confirm("确定要修改吗？")) return

                try {
                    const res = await axios.put("http://localhost:8080/depts", {
                        id: id,
                        name: newName,
                        updateTime: new Date().toISOString()
                    })
                    if (res.data.code === 1) {
                        this.getList()
                        alert("修改成功")
                    } else {
                        alert("修改失败")
                    }
                } catch (error) {
                    console.error("修改失败：", error)
                    alert("网络错误，修改失败")
                }
            },
            // 删除部门
            async del(delId) {
                if (!confirm("确定要删除吗？")) return

                try {
                    const res = await axios.delete(`http://localhost:8080/depts?id=${delId}`)
                    if (res.data.code === 1) {
                        this.getList()
                        alert("删除成功")
                    } else {
                        alert("删除失败")
                    }
                } catch (error) {
                    console.error("删除失败：", error)
                    alert("网络错误，删除失败")
                }
            }
        }
    })
</script>
</body>
</html>