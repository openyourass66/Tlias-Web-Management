<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>员工管理</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        .search-bar input, .search-bar select, .search-bar button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .search-bar button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        .search-bar button:hover {
            background-color: #45a049;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        caption {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: left;
        }
        td, th {
            text-align: center;
            border: 1px solid #ddd;
            padding: 12px;
        }
        th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #fafafa;
        }
        .operation {
            display: flex;
            justify-content: center;
            gap: 8px;
        }
        .operation button {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .edit-btn {
            background-color: #2196F3;
            color: white;
        }
        .delete-btn {
            background-color: #f44336;
            color: white;
        }
        .add-btn {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        .pagination {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 20px;
        }
        .pagination button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            cursor: pointer;
        }
        .pagination button.active {
            background-color: #2196F3;
            color: white;
            border-color: #2196F3;
        }
        .pagination button:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        .page-size {
            margin-left: 10px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
<div id="app" class="container">
    <caption>
        员工管理
        <button class="add-btn" @click="add">添加员工</button>
    </caption>

    <!-- 搜索栏 -->
    <div class="search-bar">
        <input type="text" v-model="queryParam.name" placeholder="输入员工姓名">
        <select v-model="queryParam.gender">
            <option value="">全部性别</option>
            <option value="1">男</option>
            <option value="2">女</option>
        </select>
        <input type="text" v-model="queryParam.deptName" placeholder="输入部门名称">
        <input type="date" v-model="queryParam.begin" placeholder="开始日期">
        <input type="date" v-model="queryParam.end" placeholder="结束日期">
        <button @click="getList(1)">搜索</button>
        <button @click="resetQuery">重置</button>
    </div>

    <!-- 员工表格 -->
    <table>
        <thead>
        <tr>
            <th>编号</th>
            <th>姓名</th>
            <th>用户名</th>
            <th>性别</th>
            <th>手机号</th>
            <th>职位</th>
            <th>入职日期</th>
            <th>部门</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <tr v-if="list.length === 0">
            <td colspan="9" style="color: #999;">暂无数据</td>
        </tr>
        <tr v-for="item in list" :key="item.id">
            <td>{{item.id}}</td>
            <td>{{item.name}}</td>
            <td>{{item.username}}</td>
            <td>{{item.gender === 1 ? '男' : '女'}}</td>
            <td>{{item.phone}}</td>
            <td>{{formatJob(item.job)}}</td>
            <td>{{formatDate(item.entryDate)}}</td>
            <td>{{item.deptName || '无'}}</td>
            <td class="operation">
                <button class="edit-btn" @click="update(item.id)">修改</button>
                <button class="delete-btn" @click="del(item.id)">删除</button>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- 分页控件 -->
    <div class="pagination" v-if="total > 0">
        <button @click="prevPage" :disabled="currentPage === 1">上一页</button>
        <button
                v-for="page in pageCount"
                :key="page"
                @click="getList(page)"
                :class="{active: currentPage === page}"
        >
            {{page}}
        </button>
        <button @click="nextPage" :disabled="currentPage === pageCount">下一页</button>
        <select class="page-size" v-model="pageSize" @change="getList(1)">
            <option value="5">5条/页</option>
            <option value="10">10条/页</option>
            <option value="20">20条/页</option>
            <option value="50">50条/页</option>
        </select>
        <span>共 {{total}} 条数据</span>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
    const app = new Vue({
        el: '#app',
        data: {
            list: [], // 员工列表
            currentPage: 1, // 当前页码
            pageSize: 10, // 每页条数
            total: 0, // 总条数
            queryParam: { // 查询参数
                name: '',
                gender: '',
                deptName: '',
                begin: '',
                end: ''
            }
        },
        created() {
            this.getList(1); // 初始化加载第一页
        },
        computed: {
            // 总页数
            pageCount() {
                return Math.ceil(this.total / this.pageSize);
            }
        },
        methods: {
            // 获取员工列表（带分页和查询参数）
            async getList(page) {
                this.currentPage = page; // 更新当前页码

                // 构建请求参数（包含分页和查询条件）
                const params = {
                    page: this.currentPage,
                    pageSize: this.pageSize,
                    name: this.queryParam.name.trim(),
                    gender: this.queryParam.gender ? parseInt(this.queryParam.gender) : null,
                    deptName: this.queryParam.deptName.trim(),
                    begin: this.queryParam.begin,
                    end: this.queryParam.end
                };

                try {
                    const res = await axios.get("http://localhost:8080/emps", { params });
                    if (res.data.code === 1) {
                        this.list = res.data.data.rows; // 员工列表数据
                        this.total = res.data.data.total; // 总条数
                    } else {
                        alert("获取员工列表失败：" + res.data.msg);
                    }
                } catch (error) {
                    console.error("获取员工列表失败：", error);
                    alert("网络错误，获取员工列表失败");
                }
            },

            // 格式化职位
            formatJob(job) {
                const jobMap = {
                    1: '班主任',
                    2: '讲师',
                    3: '学工主管',
                    4: '教研主管',
                    5: '咨询师'
                };
                return jobMap[job] || '其他';
            },

            // 格式化日期（YYYY-MM-DD）
            formatDate(dateStr) {
                if (!dateStr) return '';
                return new Date(dateStr).toLocaleDateString('zh-CN');
            },

            // 上一页
            prevPage() {
                if (this.currentPage > 1) {
                    this.getList(this.currentPage - 1);
                }
            },

            // 下一页
            nextPage() {
                if (this.currentPage < this.pageCount) {
                    this.getList(this.currentPage + 1);
                }
            },

            // 重置查询条件
            resetQuery() {
                this.queryParam = {
                    name: '',
                    gender: '',
                    deptName: '',
                    begin: '',
                    end: ''
                };
                this.getList(1); // 重置后查询第一页
            },

            // 添加员工
            async add() {
                const name = prompt("请输入员工姓名：").trim();
                if (!name) return alert("姓名不能为空");

                const username = prompt("请输入用户名：").trim();
                if (!username) return alert("用户名不能为空");

                const gender = prompt("请输入性别（1-男，2-女）：").trim();
                if (!gender || !['1', '2'].includes(gender)) {
                    return alert("请输入有效的性别值（1或2）");
                }

                const phone = prompt("请输入手机号：").trim();
                if (!phone || !/^1[3-9]\d{9}$/.test(phone)) {
                    return alert("请输入有效的手机号");
                }

                const job = prompt("请输入职位（1-班主任，2-讲师，3-学工主管，4-教研主管，5-咨询师）：").trim();
                if (!job || !['1', '2', '3', '4', '5'].includes(job)) {
                    return alert("请输入有效的职位值（1-5）");
                }

                const entryDate = prompt("请输入入职日期（格式：YYYY-MM-DD）：").trim();
                if (!entryDate || !/^\d{4}-\d{2}-\d{2}$/.test(entryDate)) {
                    return alert("请输入有效的日期格式");
                }

                const deptName = prompt("请输入部门名称：").trim();

                if (!confirm(`确定要添加员工【${name}】吗？`)) return;

                try {
                    const res = await axios.post("http://localhost:8080/emps", {
                        name,
                        username,
                        gender: parseInt(gender),
                        phone,
                        job: parseInt(job),
                        entryDate,
                        deptName,
                        createTime: new Date().toISOString(),
                        updateTime: new Date().toISOString()
                    });

                    if (res.data.code === 1) {
                        alert("添加成功");
                        this.getList(this.currentPage); // 刷新当前页
                    } else {
                        alert("添加失败：" + res.data.msg);
                    }
                } catch (error) {
                    console.error("添加失败：", error);
                    alert("网络错误，添加失败");
                }
            },

            // 根据id查询员工
            async getById(id) {
                try {
                    const res = await axios.get(`http://localhost:8080/emps/${id}`);
                    if (res.data.code === 1) {
                        return res.data.data;
                    } else {
                        alert("查询员工失败：" + res.data.msg);
                        return null;
                    }
                } catch (error) {
                    console.error("查询失败：", error);
                    alert("网络错误，查询失败");
                    return null;
                }
            },

            // 修改员工
            async update(id) {
                const emp = await this.getById(id);
                if (!emp) return;

                const newName = prompt("请输入新姓名：", emp.name).trim();
                if (!newName) return alert("姓名不能为空");

                const newPhone = prompt("请输入新手机号：", emp.phone).trim();
                if (!newPhone || !/^1[3-9]\d{9}$/.test(newPhone)) {
                    return alert("请输入有效的手机号");
                }

                const newJob = prompt("请输入新职位（1-班主任，2-讲师，3-学工主管，4-教研主管，5-咨询师）：", emp.job).trim();
                if (!newJob || !['1', '2', '3', '4', '5'].includes(newJob)) {
                    return alert("请输入有效的职位值（1-5）");
                }

                const newDeptName = prompt("请输入新部门名称：", emp.deptName || '').trim();

                if (!confirm(`确定要修改员工【${emp.name}】的信息吗？`)) return;

                try {
                    const res = await axios.put("http://localhost:8080/emps", {
                        id,
                        name: newName,
                        phone: newPhone,
                        job: parseInt(newJob),
                        deptName: newDeptName,
                        updateTime: new Date().toISOString()
                    });

                    if (res.data.code === 1) {
                        alert("修改成功");
                        this.getList(this.currentPage); // 刷新当前页
                    } else {
                        alert("修改失败：" + res.data.msg);
                    }
                } catch (error) {
                    console.error("修改失败：", error);
                    alert("网络错误，修改失败");
                }
            },

            // 删除员工
            async del(delId) {
                const emp = await this.getById(delId);
                if (!emp) return;

                if (!confirm(`确定要删除员工【${emp.name}】吗？此操作不可恢复！`)) return;

                try {
                    const res = await axios.delete("http://localhost:8080/emps", {
                        params: { ids: [delId] } // 适配批量删除接口
                    });

                    if (res.data.code === 1) {
                        alert("删除成功");
                        // 如果当前页是最后一页且只有1条数据，删除后跳转到上一页
                        if (this.list.length === 1 && this.currentPage > 1) {
                            this.getList(this.currentPage - 1);
                        } else {
                            this.getList(this.currentPage);
                        }
                    } else {
                        alert("删除失败：" + res.data.msg);
                    }
                } catch (error) {
                    console.error("删除失败：", error);
                    alert("网络错误，删除失败");
                }
            }
        }
    });
</script>
</body>
</html>